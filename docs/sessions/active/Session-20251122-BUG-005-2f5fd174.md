# Session: Session-20251122-BUG-005-2f5fd174

**Task ID:** BUG-005
**Agent:** Auto (TERP Roadmap Manager)
**Started:** 2025-11-22T00:00:00Z
**Expected Completion:** 2025-11-22
**Module:** `client/src/pages/ReturnsPage.tsx`, `server/routers/returns.ts`

---

## Progress

- [x] Phase 1: Pre-Flight Check
- [x] Phase 2: Session Startup
- [ ] Phase 3: Development
- [ ] Phase 4: Completion

---

## Notes

**Issues to Fix:**
1. Hardcoded `processedBy: 1` - need to use authenticated user
2. Manual Batch ID input - should select from order items
3. Need order lookup/search functionality
4. Server endpoint should use protectedProcedure to get ctx.user

**Fix Strategy:**
1. Change returns.create to protectedProcedure
2. Use ctx.user?.id instead of input.processedBy
3. Add order search/select to ReturnsPage
4. Load order line items when order selected
5. Replace Batch ID inputs with order item selection
6. Map order line items to return items correctly

