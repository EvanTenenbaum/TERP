# BUG-026: Fix Pino Logger API Signature Errors (87 TypeScript Errors)

## Overview

Fix 87 TypeScript errors across the codebase, primarily caused by incorrect Pino logger API usage.

## Problem

The codebase has 87 TypeScript compilation errors:

- **84 TS2769 errors**: Pino logger API signature mismatch
- **2 TS2353 errors**: VIP Portal type property mismatch
- **1 TS2339 error**: Settings page type issue

### Root Cause

Pino logger expects the context object as the **first** argument, but our code passes it as the **second** argument:

```typescript
// ❌ Current (wrong) - causes TS2769
logger.error("Error message", { error: unknown });

// ✅ Correct Pino API
logger.error({ err: error }, "Error message");
```

## Affected Files

### Server Files (84 logger errors)

| File                                        | Error Count |
| ------------------------------------------- | ----------- |
| `server/transactionsDb.ts`                  | 11          |
| `server/vendorSupplyDb.ts`                  | 10          |
| `server/paymentMethodsDb.ts`                | 10          |
| `server/productIntakeDb.ts`                 | 9           |
| `server/transactionHooks.ts`                | 6           |
| `server/needsMatchingService.ts`            | 6           |
| `server/strainMatcher.ts`                   | 5           |
| `server/sequenceDb.ts`                      | 5           |
| `server/orderEnhancements.ts`               | 4           |
| `server/autoMigrate.ts`                     | 4           |
| `server/productRecommendations.ts`          | 3           |
| `server/salesSheetsDb.ts`                   | 2           |
| `server/import_openthc_strains.ts`          | 2           |
| `server/auditLogger.ts`                     | 2           |
| `server/seedStrains.ts`                     | 1           |
| `server/matchingEngineReverseSimplified.ts` | 1           |
| `server/inventoryIntakeService.ts`          | 1           |
| `server/dbTransaction.ts`                   | 1           |
| `server/dashboardHelpers.ts`                | 1           |

### Client Files (3 type errors)

| File                                                     | Error Type | Issue                                            |
| -------------------------------------------------------- | ---------- | ------------------------------------------------ |
| `client/src/components/vip-portal/MarketplaceNeeds.tsx`  | TS2353     | `clientId` property doesn't exist on type        |
| `client/src/components/vip-portal/MarketplaceSupply.tsx` | TS2353     | `clientId` property doesn't exist on type        |
| `client/src/pages/Settings.tsx`                          | TS2339     | `message` property doesn't exist on type `never` |

## Fix Strategy

### 1. Logger Errors (Batch Fix)

For each logger call, swap the argument order:

```typescript
// Before
logger.error("Error creating payment method", { error: unknown });

// After
logger.error({ err: error }, "Error creating payment method");
```

**Note**: Use `err` as the key (Pino convention for error serialization).

### 2. VIP Portal Type Errors

Investigate the type definition and ensure `clientId` is properly typed in the object literal.

### 3. Settings Page Error

Fix the type narrowing issue where TypeScript infers `never` type.

## Verification

```bash
# Run TypeScript compiler
npx tsc --noEmit

# Expected output: No errors (exit code 0)
```

## Acceptance Criteria

- [ ] All 87 TypeScript errors resolved
- [ ] `npx tsc --noEmit` returns 0 errors
- [ ] All existing tests pass
- [ ] No runtime regressions in logging functionality
- [ ] Logger output format remains consistent

## Related Tasks

- **QUAL-001**: Standardize Error Handling (broader error handling improvements)
- **Previous work**: TypeScript error reduction from 976 → 605 (Dec 12, 2025)

## Implementation Guide

### Step 1: Fix Logger Errors (84 errors)

For each file, swap the argument order in logger calls:

```bash
# Pattern to find
logger.error("Message", { key: value });
logger.warn("Message", { key: value });

# Replace with
logger.error({ key: value }, "Message");
logger.warn({ key: value }, "Message");
```

**Important**: Use `err` as the key for error objects (Pino convention):

```typescript
// Before
logger.error("Error message", { error: e });

// After
logger.error({ err: e }, "Error message");
```

### Step 2: Fix VIP Portal Type Errors (2 errors)

In `MarketplaceNeeds.tsx` and `MarketplaceSupply.tsx`, the object literal includes `clientId` but the type only expects `{ id: number }`. Either:

1. Update the type to include `clientId`, or
2. Remove `clientId` from the object literal if not needed

### Step 3: Fix Settings Page Error (1 error)

In `Settings.tsx`, there's a type narrowing issue where TypeScript infers `never`. Add proper type guards or fix the conditional logic.

### Step 4: Verify

```bash
npx tsc --noEmit
# Should return 0 errors
```

## Estimate

4 hours (mostly mechanical find-and-replace with verification)
