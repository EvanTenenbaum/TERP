# BUG-104: Fix Client Detail Page Showing "Client not found"

<!-- METADATA (for validation) -->
<!-- TASK_ID: BUG-104 -->
<!-- TASK_TITLE: Fix Client Detail Page Showing "Client not found" -->
<!-- PROMPT_VERSION: 1.0 -->
<!-- LAST_VALIDATED: 2026-01-25 -->

**Repository:** https://github.com/EvanTenenbaum/TERP  
**Task ID:** BUG-104  
**Estimated Time:** 4h  
**Module:** `client/src/pages/ClientDetail.tsx`, `server/routers/clients.ts`

‚ö†Ô∏è **SECURITY WARNING**

- NEVER include real secrets in this prompt
- Use placeholders like: `YOUR_API_KEY_HERE`
- Secrets belong in `.env` file only

---

## üìã Table of Contents

1. [Context](#context)
2. [Phase 1: Pre-Flight Check](#phase-1-pre-flight-check)
3. [Phase 2: Session Startup](#phase-2-session-startup)
4. [Phase 3: Development](#phase-3-development)
5. [Phase 4: Completion](#phase-4-completion)
6. [Quick Reference](#quick-reference)
7. [Troubleshooting](#troubleshooting)

---

## üéØ Context

**Background:**
During Frontend QA testing on Jan 25, 2026, it was discovered that navigating directly to a client detail page by ID (e.g., `/clients/1`) shows "Client not found" error even though clients exist in the system and are visible in the clients list.

**Goal:**
Fix the client detail page routing and/or data fetching so that valid client IDs display the correct client information.

**Success Criteria:**

- Client detail page loads correctly when navigating via URL
- Client detail page loads correctly when clicking from clients list
- Proper error handling for actually non-existent clients
- No regression in client list functionality

---

## Implementation Guide

### Step 1: Investigate the Issue

1. Check the route definition in the router configuration
2. Verify the client ID parameter is being passed correctly
3. Check the tRPC endpoint for `clients.getById` or similar
4. Review the database query for client lookup

### Step 2: Common Root Causes

**Routing Issue:**
- Route parameter might not be correctly extracted
- Route might be conflicting with another route

**Data Fetching Issue:**
- tRPC query might be using wrong parameter name
- Client ID might be passed as string instead of number
- Query might have incorrect filter conditions

**Database Issue:**
- Client IDs might not match expected format
- Soft-delete filter might be incorrectly applied

### Step 3: Fix Implementation

Based on investigation, implement the appropriate fix:

```typescript
// Example: Ensure ID is properly parsed
const clientId = parseInt(params.id, 10);
if (isNaN(clientId)) {
  return <NotFound message="Invalid client ID" />;
}

// Example: Verify tRPC query
const { data: client } = trpc.clients.getById.useQuery({ id: clientId });
```

### Step 4: Add Error Handling

Ensure proper error states:
- Loading state while fetching
- Not found state for invalid IDs
- Error state for API failures

### Step 5: Test Scenarios

1. Navigate directly to `/clients/1` via URL
2. Click on a client from the clients list
3. Navigate to a non-existent client ID
4. Test with different client IDs

---

## Phase 1: Pre-Flight Check

**Objective:** Verify environment and check for conflicts BEFORE starting work.

### Step 1.1: Register Your Session

1. Create session file: `docs/sessions/active/Session-[DATE]-[NUMBER].md`
2. Use template: `docs/templates/SESSION_TEMPLATE.md`
3. Fill in your session details.

### Step 1.2: Register Session (Atomic) ‚ö†Ô∏è CRITICAL

**This step prevents race conditions. Follow it exactly.**

1.  `git pull origin main` (to get the latest `ACTIVE_SESSIONS.md`)
2.  Read `docs/ACTIVE_SESSIONS.md` and check for module conflicts.
3.  If clear, add your session to the file.
4.  Commit and push **immediately**:
    ```bash
    git add docs/ACTIVE_SESSIONS.md
    git commit -m "Register session for BUG-104"
    git push origin main
    ```

---

## Phase 2: Session Startup

**Objective:** Set up your workspace and update the roadmap.

### Step 2.1: Create Feature Branch

```bash
git checkout main
git pull origin main
git checkout -b fix/BUG-104-client-detail-not-found
```

### Step 2.2: Update Roadmap Status

**File:** `docs/roadmaps/MASTER_ROADMAP.md`

Change the status of BUG-104 to `in-progress`.

---

## Phase 3: Development

**Objective:** Fix the client detail page issue.

1. Reproduce the issue in development
2. Investigate routing and data fetching
3. Identify root cause
4. Implement fix
5. Test all scenarios
6. Verify no regressions

---

## Phase 4: Completion

**Objective:** Finalize your work and submit it for review.

### Step 4.1: Verify All Deliverables

- [ ] Client detail page loads via direct URL
- [ ] Client detail page loads via list click
- [ ] Non-existent clients show appropriate error
- [ ] All tests pass

### Step 4.2: Create Completion Report

Use the template at `docs/templates/COMPLETION_REPORT_TEMPLATE.md`.

### Step 4.3: Update Roadmap to `complete`

Change the status of BUG-104 to `complete` in `docs/roadmaps/MASTER_ROADMAP.md`.

---

## ‚ö° Quick Reference

**Files to investigate:**
- `client/src/pages/ClientDetail.tsx`
- `client/src/router.tsx` or route configuration
- `server/routers/clients.ts`
- `server/clientsDb.ts`

**tRPC endpoints:**
- `clients.getById`
- `clients.getByTeriCode`

---

## üÜò Troubleshooting

**Issue:** ID parameter is undefined
**Solution:** Check route configuration and parameter extraction

**Issue:** Query returns null for valid ID
**Solution:** Check database query conditions and soft-delete filters

**Issue:** Type mismatch (string vs number)
**Solution:** Ensure consistent ID type handling across frontend and backend
