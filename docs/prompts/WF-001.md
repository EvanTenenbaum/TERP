# WF-001: Wire Notification Triggers to Business Events

## Implementation Guide

### Problem

The `server/services/notificationTriggers.ts` file defines 15 trigger functions, but only 3 are actually called:

- `onOrderCreated()` - ✅ Called (orders.ts)
- `onInvoiceCreated()` - ✅ Called (accounting.ts)
- `onPaymentReceived()` - ✅ Called (accounting.ts)

The remaining 12 triggers are **dead code** - never invoked:

- `onOrderConfirmed()`, `onOrderShipped()`, `onOrderDelivered()`
- `onInvoiceOverdue()`
- `onInventoryLow()`, `onBatchReceived()`
- `onTaskAssigned()`, `onTaskDueSoon()`
- `onAppointmentReminder()`
- `onCreditIssued()`
- `onInterestListSubmitted()`

### Solution

Wire each trigger to its corresponding mutation/cron:

**Order Status Triggers:**

- `server/routers/orders.ts` → `updateOrderStatus` mutation
- Call `onOrderConfirmed`, `onOrderShipped`, `onOrderDelivered` based on new status

**Inventory Triggers:**

- `server/routers/inventory.ts` → After quantity adjustment, check low stock → `onInventoryLow`
- `server/routers/intakeReceipts.ts` → After batch intake completes → `onBatchReceived`

**Task Triggers:**

- `server/routers/todoTasks.ts` → Also call `onTaskAssigned` (currently only creates inbox item)
- Create cron: `server/cron/taskReminderCron.ts` → `onTaskDueSoon` (tasks due within 24h)

**Calendar Triggers:**

- Create cron: `server/cron/appointmentReminderCron.ts` → `onAppointmentReminder`

**Finance Triggers:**

- `server/routers/credits.ts` → After credit issued → `onCreditIssued`
- Create cron: `server/cron/invoiceOverdueCron.ts` → `onInvoiceOverdue`

**VIP Portal Triggers:**

- `server/routers/vipPortal.ts` → After interest list submitted → `onInterestListSubmitted`

### Files to Modify

- `server/routers/orders.ts`
- `server/routers/inventory.ts`
- `server/routers/intakeReceipts.ts`
- `server/routers/todoTasks.ts`
- `server/routers/credits.ts`
- `server/routers/vipPortal.ts`
- `server/cron/taskReminderCron.ts` (NEW)
- `server/cron/appointmentReminderCron.ts` (NEW)
- `server/cron/invoiceOverdueCron.ts` (NEW)

### Acceptance Criteria

- All 15 notification triggers are invoked at appropriate times
- Notifications appear in user inbox
- Email/SMS sent if user has those channels enabled
- Cron jobs run on schedule and create notifications

### Verification

```bash
# Verify all triggers are imported somewhere
grep -r "import.*notificationTriggers" server/routers server/cron
# Should show imports for all trigger functions
```

### Estimate

8 hours
