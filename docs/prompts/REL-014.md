# REL-014: Critical Correctness Test Harness (Seed + Invariant Suite + Concurrency Scenarios)

<!-- METADATA (for validation) -->
<!-- TASK_ID: REL-014 -->
<!-- TASK_TITLE: Critical Correctness Test Harness -->
<!-- PROMPT_VERSION: 1.0 -->
<!-- LAST_VALIDATED: 2026-01-08 -->

**Repository:** https://github.com/EvanTenenbaum/TERP  
**Task ID:** REL-014  
**Estimated Time:** 2d  
**Module:** `server/*integration.test.ts`, `scripts/`, `drizzle/`

## Implementation Guide

### Problem
No single suite proves "accounting-grade" invariants after real sequences of mutations and concurrency.

### Solution
- Deterministic seed fixtures for:
  - inventory: receive → fulfill → reverse → adjust
  - money: invoice → partial pay → credit apply → reversal
- After every step, run invariant queries (from REL-001).
- Add concurrency tests validating locking + idempotency.

### Deliverables
- Deterministic seed fixture(s) for reliability tests
- "critical correctness suite" test command documented
- Property-style/randomized edge-case generation for amounts/qty within constraints
- Concurrency test scenarios added
- CI job runs the suite for PRs touching critical domains

### Acceptance Criteria
- One command runs critical correctness suite.
- CI runs suite for PRs touching critical paths.
