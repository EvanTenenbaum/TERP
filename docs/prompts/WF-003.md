# WF-003: Merge Notifications and Inbox Systems

## Implementation Guide

### Problem

Two parallel, unconnected notification systems:

**System A: notifications table**

- Multi-channel: in_app, email, sms
- Used for: orders, invoices, payments
- Accessed via: Bell icon, /notifications page
- Created by: notificationService

**System B: inbox_items table**

- Source types: mention, task_assignment, task_update
- Used for: task assignments, @mentions
- Accessed via: /inbox page
- Created by: inboxDb

**Issues:**

- User must check TWO places for action items
- Same event (task assignment) could create entry in one OR the other
- Confusing UX

### Solution

Create unified inbox that:

1. Combines both data sources
2. Single UI for all action items
3. Consistent notification creation API

### Implementation

**Option A: Merge into notifications table**

1. Add `sourceType`, `sourceId`, `referenceType`, `referenceId` to notifications
2. Deprecate inbox_items table
3. Update all inboxDb calls to use notificationService
4. Create unified inbox UI that queries notifications

**Option B: Create view that unions both**

1. Keep both tables
2. Create unified API that queries both
3. Single UI presents combined results

### Files to Modify

**Database:**

- `drizzle/schema.ts` - Modify notifications table or create view

**Backend:**

- `server/inboxDb.ts` - Deprecate or redirect
- `server/services/notificationService.ts` - Handle all notification types
- `server/routers/inbox.ts` - Query unified source

**Frontend:**

- `client/src/pages/InboxPage.tsx` - Show all action items
- `client/src/components/notifications/*` - Unify components
- Remove duplicate notification/inbox UI code

### Acceptance Criteria

- Single place for all action items
- Consistent notification creation
- No data loss from migration
- Email/SMS still works

### Estimate

2 days
