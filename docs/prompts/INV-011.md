# INV-011: Refactor Hardcoded Batch Status Strings

## Implementation Guide

### Problem

348 hardcoded batch status strings across 59 files create inconsistency risk. The `SELLABLE_BATCH_STATUSES` constant was created in `server/inventoryDb.ts` but not adopted everywhere.

Current patterns found:

- `['LIVE', 'PHOTOGRAPHY_COMPLETE']` - 15 occurrences
- `['LIVE', 'PHOTOGRAPHY_COMPLETE', 'ON_HOLD']` - 3 occurrences
- `'LIVE'` only - 25+ occurrences
- Various other combinations

### Affected Files

```
server/vendorContextDb.ts
server/dataCardMetricsDb.ts
server/dashboardAnalytics.ts
server/inventoryAlerts.ts
server/matchingEngine.ts
server/matchingEngineEnhanced.ts
server/cogsCalculation.ts
server/routers/alerts.ts
server/routers/inventory.ts
server/routers/photography.ts
server/routers/productCategories.ts
server/services/liveCatalogService.ts
server/services/catalogPublishingService.ts
... and 46 more files
```

### Solution

1. **Create status constant module** (`server/constants/batchStatuses.ts`):

   ```typescript
   export const BATCH_STATUSES = {
     AWAITING_INTAKE: "AWAITING_INTAKE",
     LIVE: "LIVE",
     PHOTOGRAPHY_COMPLETE: "PHOTOGRAPHY_COMPLETE",
     ON_HOLD: "ON_HOLD",
     QUARANTINED: "QUARANTINED",
     SOLD_OUT: "SOLD_OUT",
     CLOSED: "CLOSED",
   } as const;

   export type BatchStatus =
     (typeof BATCH_STATUSES)[keyof typeof BATCH_STATUSES];

   // Sellable = can be sold to customers
   export const SELLABLE_BATCH_STATUSES = [
     BATCH_STATUSES.LIVE,
     BATCH_STATUSES.PHOTOGRAPHY_COMPLETE,
   ] as const;

   // Active = has inventory that matters for operations
   export const ACTIVE_BATCH_STATUSES = [
     BATCH_STATUSES.LIVE,
     BATCH_STATUSES.PHOTOGRAPHY_COMPLETE,
     BATCH_STATUSES.ON_HOLD,
   ] as const;
   ```

2. **Refactor files to use constants**:
   - Replace hardcoded status arrays with appropriate constant
   - Update imports

3. **Add ESLint rule** to prevent new hardcoded strings (optional):
   ```javascript
   // .eslintrc.js
   'no-restricted-syntax': ['error', {
     selector: "Literal[value=/^(LIVE|AWAITING_INTAKE|SOLD_OUT)$/]",
     message: "Use BATCH_STATUSES constant instead of hardcoded status string"
   }]
   ```

### Verification

```bash
# Count remaining hardcoded strings
grep -r "\"LIVE\"\|'LIVE'" server/ --include="*.ts" | wc -l

# Should be 0 (or only in constants file)
```

### Acceptance Criteria

- [ ] All 59 affected files refactored to use constants
- [ ] Single source of truth for batch status values
- [ ] TypeScript types provide autocomplete for status values
- [ ] No regression in existing functionality
- [ ] Tests updated to use constants
