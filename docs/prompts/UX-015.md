# UX-015: Add Confirmation Dialogs for 14 Delete Actions

<!-- METADATA (for validation) -->
<!-- TASK_ID: UX-015 -->
<!-- TASK_TITLE: Add Confirmation Dialogs for 14 Delete Actions -->
<!-- PROMPT_VERSION: 1.0 -->
<!-- LAST_VALIDATED: 2026-01-14 -->

**Repository:** https://github.com/EvanTenenbaum/TERP
**Task ID:** UX-015
**Estimated Time:** 8h
**Module:** Multiple frontend components

## Context

**Background:**
14 destructive actions lack confirmation dialogs:

1. `Settings.tsx:505` - Delete location
2. `Settings.tsx:639` - Delete category
3. `Settings.tsx:687-689` - Delete subcategory (BROKEN - no handler!)
4. `Settings.tsx:803` - Delete grade
5. `RoomManagementModal.tsx:308` - Remove feature
6. `AddClientWizard.tsx:464` - Remove tag
7. `UserSelector.tsx:121` - Remove user
8. `EditBatchModal.tsx:288` - Remove media
9. `PricingRulesPage.tsx:296` - Remove condition
10. `ReturnsPage.tsx:352` - Remove return item
11. `OrganizationSettings.tsx:587` - Delete unit type
12. `OrganizationSettings.tsx:885` - Delete finance status
13. `CalendarAppointmentTypes.tsx:201` - Delete appointment type
14. `CalendarAvailabilitySettings.tsx:265` - Delete blocked time

Users can accidentally delete important data with no warning.

**Goal:**
Add confirmation dialogs to all destructive actions.

**Success Criteria:**
- All delete actions require confirmation
- Consistent dialog design
- Clear messaging about consequences

## Implementation Guide

### Step 1: Create Reusable Confirmation Dialog

```tsx
// components/ui/ConfirmDialog.tsx
import {
  AlertDialog,
  AlertDialogAction,
  AlertDialogCancel,
  AlertDialogContent,
  AlertDialogDescription,
  AlertDialogFooter,
  AlertDialogHeader,
  AlertDialogTitle,
} from "@/components/ui/alert-dialog";

interface ConfirmDialogProps {
  open: boolean;
  onOpenChange: (open: boolean) => void;
  title: string;
  description: string;
  confirmText?: string;
  cancelText?: string;
  onConfirm: () => void;
  variant?: "default" | "destructive";
}

export function ConfirmDialog({
  open,
  onOpenChange,
  title,
  description,
  confirmText = "Delete",
  cancelText = "Cancel",
  onConfirm,
  variant = "destructive"
}: ConfirmDialogProps) {
  return (
    <AlertDialog open={open} onOpenChange={onOpenChange}>
      <AlertDialogContent>
        <AlertDialogHeader>
          <AlertDialogTitle>{title}</AlertDialogTitle>
          <AlertDialogDescription>{description}</AlertDialogDescription>
        </AlertDialogHeader>
        <AlertDialogFooter>
          <AlertDialogCancel>{cancelText}</AlertDialogCancel>
          <AlertDialogAction
            onClick={onConfirm}
            className={variant === "destructive" ? "bg-red-600 hover:bg-red-700" : ""}
          >
            {confirmText}
          </AlertDialogAction>
        </AlertDialogFooter>
      </AlertDialogContent>
    </AlertDialog>
  );
}
```

### Step 2: Create useConfirmDialog Hook

```tsx
// hooks/useConfirmDialog.ts
export function useConfirmDialog() {
  const [isOpen, setIsOpen] = useState(false);
  const [pendingAction, setPendingAction] = useState<() => void>(() => {});

  const confirm = (action: () => void) => {
    setPendingAction(() => action);
    setIsOpen(true);
  };

  const handleConfirm = () => {
    pendingAction();
    setIsOpen(false);
  };

  return { isOpen, setIsOpen, confirm, handleConfirm };
}
```

### Step 3: Update Each Component

**Example for Settings.tsx:**

```tsx
// Before
<Button onClick={() => deleteLocation(id)}>Delete</Button>

// After
const [deleteConfirm, setDeleteConfirm] = useState<number | null>(null);

<Button onClick={() => setDeleteConfirm(id)}>Delete</Button>

<ConfirmDialog
  open={deleteConfirm !== null}
  onOpenChange={(open) => !open && setDeleteConfirm(null)}
  title="Delete Location"
  description="Are you sure you want to delete this location? This action cannot be undone."
  onConfirm={() => {
    if (deleteConfirm) deleteLocation(deleteConfirm);
    setDeleteConfirm(null);
  }}
/>
```

### Step 4: Fix Broken Delete Handler

`Settings.tsx:687-689` has no onClick handler. Fix it:
```tsx
// Currently broken
<Button>Delete</Button>

// Fixed
<Button onClick={() => setDeleteSubcategoryConfirm(id)}>Delete</Button>
```

### Step 5: Test Each Dialog

For each of the 14 locations:
1. Click delete button
2. Verify dialog appears
3. Click cancel - verify no deletion
4. Click confirm - verify deletion

## Deliverables

- [ ] Create ConfirmDialog component
- [ ] Create useConfirmDialog hook
- [ ] Update Settings.tsx (5 locations)
- [ ] Update RoomManagementModal.tsx
- [ ] Update AddClientWizard.tsx
- [ ] Update UserSelector.tsx
- [ ] Update EditBatchModal.tsx
- [ ] Update PricingRulesPage.tsx
- [ ] Update ReturnsPage.tsx
- [ ] Update OrganizationSettings.tsx (2 locations)
- [ ] Update CalendarAppointmentTypes.tsx
- [ ] Update CalendarAvailabilitySettings.tsx
- [ ] Fix broken delete subcategory handler

## Quick Reference

**Files to update:**
- `client/src/pages/Settings.tsx`
- `client/src/components/RoomManagementModal.tsx`
- `client/src/components/AddClientWizard.tsx`
- `client/src/components/UserSelector.tsx`
- `client/src/components/EditBatchModal.tsx`
- `client/src/pages/PricingRulesPage.tsx`
- `client/src/pages/ReturnsPage.tsx`
- `client/src/pages/OrganizationSettings.tsx`
- `client/src/pages/CalendarAppointmentTypes.tsx`
- `client/src/pages/CalendarAvailabilitySettings.tsx`
