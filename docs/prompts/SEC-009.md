# SEC-009: Protect VIP Portal Needs Data Exposure

## Implementation Guide

### Problem
The `alerts.getNeedsForVipPortal` endpoint (line ~176) uses `publicProcedure`, exposing all active client needs publicly - a critical business intelligence leak.

### Affected Endpoints
- `alerts.getNeedsForVipPortal` (line ~176)

### Solution
1. Change from `publicProcedure` to `vipPortalProcedure`
2. Filter results to only show needs for the authenticated VIP client
3. Add proper VIP session validation

### Files to Modify
- `server/routers/alerts.ts`

### Code Example
```typescript
// BEFORE
getNeedsForVipPortal: publicProcedure.query(async () => {
  // Returns ALL client needs
})

// AFTER
getNeedsForVipPortal: vipPortalProcedure.query(async ({ ctx }) => {
  // Filter by ctx.vipPortalClientId
  return getActiveNeedsForClient(ctx.vipPortalClientId);
})
```

### Verification
```bash
# Unauthenticated request should fail
curl -X GET https://terp-app.../api/trpc/alerts.getNeedsForVipPortal
# Should return 401/403
```

### Acceptance Criteria
- Endpoint requires VIP portal authentication
- Only returns data for authenticated client
- No exposure of other clients' business data
