# REL-010: Inventory Reconciliation Pack (Drift + Impossible State Detection + Fix via Adjustment Movements)

<!-- METADATA (for validation) -->
<!-- TASK_ID: REL-010 -->
<!-- TASK_TITLE: Inventory Reconciliation Pack -->
<!-- PROMPT_VERSION: 1.0 -->
<!-- LAST_VALIDATED: 2026-01-08 -->

**Repository:** https://github.com/EvanTenenbaum/TERP  
**Task ID:** REL-010  
**Estimated Time:** 16h  
**Module:** `server/_core/reconciliationService.ts`, `server/inventory*.ts`

## Implementation Guide

### Problem
Inventory drift can silently corrupt availability and fulfillment.

### Solution
- Implement checks:
  - sum(movements) vs projection mismatch
  - negative on-hand
  - orphan movements
  - impossible reserved/onhand relationships (if reserved exists)
- Fix mode:
  - ONLY creates explicit adjustment movements (never silent overwrites)
  - requires `--confirm` and records audit events

### Deliverables
- Inventory reconciliation module added
- Report includes causality pointers (which batch/location/movement)
- Fix mode generates explicit adjustment movements (audited)
- Safety rails: fix requires `--confirm` and logs every change
- Tests cover drift detection and safe repair behavior

### Acceptance Criteria
- Drift is detected and reported with causality pointers.
- Fix mode produces auditable movement corrections only.
