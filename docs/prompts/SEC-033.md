# SEC-033: Convert Calendar Router to protectedProcedure

## Problem

Calendar router at `server/routers/calendar.ts` exposes 10 publicProcedure endpoints including createEvent, updateEvent, deleteEvent. Anyone can manipulate calendar data without authentication.

## Implementation Guide

### Step 1: Update Imports

```typescript
import { protectedProcedure, router } from "../_core/trpc";
import { requirePermission } from "../_core/permissionMiddleware";
```

### Step 2: Convert Each Endpoint

```typescript
// BEFORE:
getEvents: publicProcedure.query(...)

// AFTER:
getEvents: protectedProcedure
  .use(requirePermission("calendar:read"))
  .query(...)

createEvent: protectedProcedure
  .use(requirePermission("calendar:create"))
  .mutation(...)

updateEvent: protectedProcedure
  .use(requirePermission("calendar:update"))
  .mutation(...)

deleteEvent: protectedProcedure
  .use(requirePermission("calendar:delete"))
  .mutation(...)
```

### Step 3: Update User Context

Remove fallback to userId = 1:

```typescript
// BEFORE:
const userId = ctx.user?.id ?? 1;

// AFTER:
const userId = ctx.user.id; // protectedProcedure guarantees user exists
```

## Acceptance Criteria

- [ ] All 10 calendar endpoints use protectedProcedure
- [ ] Appropriate permission checks added
- [ ] No userId fallback to hardcoded value
- [ ] Unauthenticated requests return 401
- [ ] Existing functionality works for authenticated users

## Files to Modify

- `server/routers/calendar.ts`
