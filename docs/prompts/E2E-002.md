# E2E-002: Update Orders Page UI Selectors for E2E Tests

<!-- METADATA (for validation) -->
<!-- TASK_ID: E2E-002 -->
<!-- TASK_TITLE: Update Orders Page UI Selectors for E2E Tests -->
<!-- PROMPT_VERSION: 1.0 -->
<!-- LAST_VALIDATED: 2026-01-16 -->

**Repository:** https://github.com/EvanTenenbaum/TERP  
**Task ID:** E2E-002  
**Estimated Time:** 4h  
**Module:** `tests-e2e/orders-crud.spec.ts`, `client/src/pages/orders/`

‚ö†Ô∏è **SECURITY WARNING**

- NEVER include real secrets in this prompt
- Use placeholders like: `YOUR_API_KEY_HERE`
- Secrets belong in `.env` file only

---

## üìã Table of Contents

1. [Context](#context)
2. [Phase 1: Pre-Flight Check](#phase-1-pre-flight-check)
3. [Phase 2: Session Startup](#phase-2-session-startup)
4. [Phase 3: Development](#phase-3-development)
5. [Phase 4: Completion](#phase-4-completion)
6. [Quick Reference](#quick-reference)
7. [Troubleshooting](#troubleshooting)

---

## üéØ Context

**Background:**
E2E tests for the Orders page fail because the UI selectors expect a standard `<table>` element, but the Orders page uses a different component structure (possibly cards, virtual list, or custom grid). The database contains 400 orders, but the E2E test reports "Table not found".

**Goal:**
Update E2E test selectors to match the actual Orders page UI structure, ensuring tests can verify order data is displayed correctly.

**Success Criteria:**

- Orders CRUD tests pass against production
- Selectors match actual UI components
- Tests verify correct number of orders displayed
- No false positives (tests actually verify data presence)

---

## Implementation Guide

### Step 1: Analyze Orders Page UI Structure

1. Navigate to Orders page in browser
2. Inspect DOM structure using DevTools
3. Identify the actual component used (table, grid, cards, virtual list)
4. Document the correct selectors

```bash
# Check the Orders page component
cat client/src/pages/orders/OrdersPage.tsx
cat client/src/pages/orders/OrdersList.tsx
```

### Step 2: Update Test Selectors

**File:** `tests-e2e/orders-crud.spec.ts`

Current (broken):

```typescript
const table = page.locator("table, [role='grid'], .data-table");
const rows = page.locator("table tbody tr, [role='row']");
```

Update to match actual UI:

```typescript
// Example if using DataTable component
const ordersList = page.locator('[data-testid="orders-list"]');
const orderItems = page.locator('[data-testid="order-row"]');

// Or if using cards
const orderCards = page.locator('.order-card, [data-testid="order-card"]');
```

### Step 3: Add data-testid Attributes (if needed)

If the Orders page lacks proper test IDs, add them:

**File:** `client/src/pages/orders/OrdersList.tsx`

```tsx
<div data-testid="orders-list">
  {orders.map(order => (
    <div key={order.id} data-testid="order-row">
      {/* order content */}
    </div>
  ))}
</div>
```

### Step 4: Update All Orders-Related Tests

Files to update:

- `tests-e2e/orders-crud.spec.ts`
- `tests-e2e/create-order.spec.ts`
- `tests-e2e/critical-paths/order-fulfillment-workflow.spec.ts`
- `tests-e2e/oracles/orders/*.yaml`

### Step 5: Validation

```bash
# Run orders tests against production
PLAYWRIGHT_BASE_URL=https://terp-app-b9s35.ondigitalocean.app \
pnpm exec playwright test tests-e2e/orders-crud.spec.ts

# Verify row count matches database
# Database has 400 orders
```

---

## Phase 1: Pre-Flight Check

**Objective:** Verify environment and check for conflicts BEFORE starting work.

### Step 1.1: Register Your Session

1. Create session file: `docs/sessions/active/Session-[DATE]-[NUMBER].md`
2. Use template: `docs/templates/SESSION_TEMPLATE.md`

### Step 1.2: Verify Environment

```bash
node --version
pnpm --version
git status
```

---

## Phase 2: Session Startup

### Step 2.1: Create Feature Branch

```bash
git checkout main
git pull origin main
git checkout -b E2E-002-fix-orders-selectors
```

### Step 2.2: Update Roadmap Status

Change E2E-002 status to `in-progress` in `docs/roadmaps/MASTER_ROADMAP.md`.

---

## Phase 3: Development

Follow the Implementation Guide above.

---

## Phase 4: Completion

### Step 4.1: Verify All Deliverables

- [ ] Orders page selectors updated
- [ ] data-testid attributes added if needed
- [ ] All 11 orders-crud tests pass
- [ ] Order count verification works
- [ ] Documentation updated

### Step 4.2: Push and Create PR

```bash
git add .
git commit -m "fix(e2e): Update Orders page UI selectors to match actual components"
git push origin E2E-002-fix-orders-selectors
```

---

## ‚ö° Quick Reference

| File                                     | Purpose               |
| ---------------------------------------- | --------------------- |
| `tests-e2e/orders-crud.spec.ts`          | Orders CRUD tests     |
| `client/src/pages/orders/OrdersPage.tsx` | Orders page component |
| `client/src/pages/orders/OrdersList.tsx` | Orders list component |

---

## üÜò Troubleshooting

**Issue:** Cannot find any order elements
**Solution:** Check if page uses lazy loading or virtual scrolling

**Issue:** Row count doesn't match database
**Solution:** Check pagination - page may only show first N orders
