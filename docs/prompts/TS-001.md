# TS-001: Fix Remaining TypeScript Errors (117 errors)

<!-- METADATA (for validation) -->
<!-- TASK_ID: TS-001 -->
<!-- TASK_TITLE: Fix Remaining TypeScript Errors (117 errors) -->
<!-- PROMPT_VERSION: 1.0 -->
<!-- LAST_VALIDATED: 2026-01-20 -->

**Repository:** https://github.com/EvanTenenbaum/TERP
**Task ID:** TS-001
**Estimated Time:** 2d
**Module:** `client/src/`, `server/`

## Context

**Background:**
The codebase has 117 TypeScript errors distributed across 30+ files. These errors prevent strict type checking from passing (`npm run check` fails) and create potential for runtime bugs.

**Error Distribution (by file):**
| File | Error Count | Category |
|------|-------------|----------|
| `server/routers/hourTracking.ts` | 13 | Server Router |
| `client/src/components/work-surface/InventoryWorkSurface.tsx` | 8 | Work Surface |
| `server/services/orderPricingService.ts` | 6 | Service Layer |
| `server/services/live-shopping/sessionPickListService.ts` | 6 | Service Layer |
| `server/routers/clientLedger.ts` | 6 | Server Router |
| `client/src/components/work-surface/PickPackWorkSurface.tsx` | 6 | Work Surface |
| `server/routers/intakeReceipts.ts` | 5 | Server Router |
| `server/routers/cogs.ts` | 5 | Server Router |
| `client/src/components/work-surface/golden-flows/OrderToInvoiceFlow.tsx` | 5 | Golden Flow |
| `client/src/components/work-surface/golden-flows/InvoiceToPaymentFlow.tsx` | 4 | Golden Flow |
| Other files (20+) | 53 | Various |

**Goal:**
Achieve zero TypeScript errors while maintaining backward compatibility and without changing runtime behavior.

**Success Criteria:**

- `npm run check` passes (0 errors)
- All existing tests continue to pass
- No runtime behavioral changes
- No regressions in API response shapes

## Implementation Guide

### Step 1: Run TypeScript Check to Get Current Errors

```bash
npm run check 2>&1 | tee typescript-errors.log
npm run check 2>&1 | grep "error TS" | wc -l  # Should show 117
```

### Step 2: Fix Server Router Errors (40 errors)

**2.1 hourTracking.ts (13 errors)**
Common patterns:

- Pino logger API signature mismatches - swap object and message order
- Type narrowing for nullable fields
- Schema column type mismatches

```typescript
// BEFORE (wrong Pino signature)
logger.error("Error message", { error, input });

// AFTER (correct Pino signature)
logger.error({ error, input }, "Error message");
```

**2.2 clientLedger.ts (6 errors)**

- Lines 195, 234, 275, 319: `undefined` assigned to `number` type
- Lines 354-355: Optional number fields
- Fix: Add null coalescing or type assertions

```typescript
// BEFORE
balance: transaction.balance; // undefined when not set

// AFTER
balance: transaction.balance ?? 0;
```

**2.3 intakeReceipts.ts (5 errors)**

- Type mismatches in query results
- Fix: Use proper type assertions or update interface

**2.4 cogs.ts (5 errors)**

- Pino logger API signature errors (same pattern as hourTracking)

### Step 3: Fix Work Surface Errors (35 errors)

**3.1 InventoryWorkSurface.tsx (8 errors)**
Primary issue: `batch.grade` is `string | null` but interface expects `string | undefined`

- Line 345: Status type mismatch
- Line 352: Missing `pagination` property
- Lines 357, 377, 556, 628: Grade type incompatibility

```typescript
// Fix: Update InventoryItem interface or cast
interface InventoryItem {
  batch: {
    grade: string | null; // Change from string | undefined
    // ...
  };
}
```

**3.2 PickPackWorkSurface.tsx (6 errors)**

- Lines 510, 525, 540: Missing required arguments
- Line 622: KeyboardOptions type mismatch
- Line 719: Wrong argument count
- Line 993: fulfillmentStatus null handling

**3.3 ClientLedgerWorkSurface.tsx (2 errors)**

- Line 734: WorkSurfaceKeyboardOptions type mismatch
- Line 782: Wrong argument count

**3.4 OrdersWorkSurface.tsx (2 errors)**

- Line 390: Missing `confirm` property on router
- Line 400: Implicit `any` type for error parameter

**3.5 PurchaseOrdersWorkSurface.tsx (3 errors)**

- Lines 475, 500, 781: Implicit `any` parameters

**3.6 DirectIntakeWorkSurface.tsx (2 errors)**

- Line 612: Invalid field path type
- Line 737: Missing `errors` property on ZodError

### Step 4: Fix Golden Flow Errors (12 errors)

**4.1 OrderToInvoiceFlow.tsx (5 errors)**

- Line 580: Function always truthy (should call function)
- Line 655: Date type mismatch for `confirmedAt`
- Lines 663, 680: Missing properties
- Line 702: Extra property in object literal

**4.2 InvoiceToPaymentFlow.tsx (4 errors)**

- Line 578: Function always truthy
- Line 650: Date type mismatch for `invoiceDate`
- Line 689: Property access on number
- Line 716: Invalid payment method string

**4.3 OrderCreationFlow.tsx (3 errors)**

- Line 581: Missing `batches` property
- Line 674: Extra `lineItems` property
- Line 698: Extra `onCommit` property

### Step 5: Fix Service Layer Errors (16 errors)

**5.1 orderPricingService.ts (6 errors)**

- Type mismatches in price calculations
- Nullable field handling

**5.2 sessionPickListService.ts (6 errors)**

- Session/pick list type mismatches

**5.3 payablesService.ts (2 errors)**

- Payment type handling

**5.4 notificationRepository.ts (2 errors)**

- Notification type mismatches

### Step 6: Fix Miscellaneous Client Errors (26 errors)

**6.1 SearchResultsPage.tsx (3 errors)**

- Lines 159, 206, 262: `unknown` type assigned to `ReactNode`
- Fix: Add type assertions or proper type guards

**6.2 SalesSheetCreatorPage.tsx (2 errors)**

- Line 454: Extra properties on props
- Line 467: Type mismatch in reorder handler

**6.3 useBreakpoint.tsx (2 errors)**

- Lines 123, 139: Variable used before assignment
- Fix: Initialize `timeoutId` properly

**6.4 Other files (19 errors)**

- Various type mismatches
- Import issues
- Interface incompatibilities

### Step 7: Validate Fixes

```bash
# Run TypeScript check
npm run check

# Run tests to ensure no regressions
npm run test

# Run build to ensure compilation works
npm run build
```

### Step 8: Common Fix Patterns Reference

**Pattern 1: Pino Logger Signature**

```typescript
// Wrong
logger.error("message", { data });
// Correct
logger.error({ data }, "message");
```

**Pattern 2: Nullable to Optional**

```typescript
// When interface expects undefined but DB returns null
value: dbResult.field ?? undefined;
```

**Pattern 3: Type Assertions for Known Safe Casts**

```typescript
// When you know the type is correct but TS doesn't
const item = result as ExpectedType;
```

**Pattern 4: Fix Implicit Any**

```typescript
// Before
.catch((err) => { ... })
// After
.catch((err: Error) => { ... })
```

**Pattern 5: Date Handling**

```typescript
// When interface expects string but DB returns Date
dateField: dbResult.dateColumn?.toISOString();
```

## Deliverables

- [ ] Fix 13 errors in `server/routers/hourTracking.ts`
- [ ] Fix 8 errors in `client/src/components/work-surface/InventoryWorkSurface.tsx`
- [ ] Fix 6 errors in `server/services/orderPricingService.ts`
- [ ] Fix 6 errors in `server/services/live-shopping/sessionPickListService.ts`
- [ ] Fix 6 errors in `server/routers/clientLedger.ts`
- [ ] Fix 6 errors in `client/src/components/work-surface/PickPackWorkSurface.tsx`
- [ ] Fix 5 errors in `server/routers/intakeReceipts.ts`
- [ ] Fix 5 errors in `server/routers/cogs.ts`
- [ ] Fix 12 errors in golden flow components
- [ ] Fix 26 errors in miscellaneous client components
- [ ] Fix 24 errors in remaining server/service files
- [ ] Verify `npm run check` passes
- [ ] Verify all tests pass
- [ ] Verify build succeeds

## Quick Reference

**Check current errors:**

```bash
npm run check 2>&1 | grep "error TS" | wc -l
```

**Group errors by file:**

```bash
npm run check 2>&1 | grep "error TS" | cut -d'(' -f1 | sort | uniq -c | sort -rn
```

**Search for specific error pattern:**

```bash
npm run check 2>&1 | grep "TS2322"  # Type assignment errors
npm run check 2>&1 | grep "TS7006"  # Implicit any errors
npm run check 2>&1 | grep "TS2339"  # Property doesn't exist errors
```
