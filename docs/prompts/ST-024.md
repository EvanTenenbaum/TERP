# ST-024: Remove Comments Feature

## Overview

Remove the comments feature from both frontend and backend to simplify the codebase and reduce maintenance burden.

## Problem Statement

The comments feature is currently unused in the application. It adds unnecessary code complexity, increases bundle size, and requires maintenance without providing value. Removing it will streamline the codebase.

## Implementation Guide

### Step 1: Audit (30 min)

```bash
# Search for all comments references
grep -r "comments" server/ --include="*.ts"
grep -r "comments" client/src/ --include="*.tsx" --include="*.ts"

# Check database for existing data
npx tsx scripts/prod-db-query.ts "SELECT COUNT(*) FROM comments"
```

### Step 2: Backend Removal (1.5h)

```bash
# Remove from routers.ts
# Delete server/routers/comments.ts
# Remove any comments-related imports
```

### Step 3: Frontend Removal (1.5h)

```bash
# Remove comments components
# Remove comments hooks
# Remove comments from page components
```

### Step 4: Database Soft-Deprecation (30 min)

```sql
-- Add migration to soft-delete all comments
UPDATE comments SET deleted_at = NOW() WHERE deleted_at IS NULL;
```

## Pre-Removal Audit

Before removing, verify these are NOT dependent on comments:

### Backend Files to Check

- `server/routers/comments.ts` - Main comments router
- `server/routers.ts` - Router registration
- `drizzle/schema.ts` - Comments table definition
- Any files importing from comments router

### Frontend Files to Check

- `client/src/components/comments/` - Comments components (if exists)
- Any pages that render comments
- Any hooks related to comments

### Database

- `comments` table - Check row count and last activity
- Foreign key relationships to other tables

## Removal Steps

### Phase 1: Audit (30 min)

1. Search codebase for "comments" references
2. Document all usages
3. Check database for existing comment data
4. Verify no critical features depend on comments

### Phase 2: Backend Removal (1.5h)

1. Remove `commentsRouter` from `server/routers.ts`
2. Delete `server/routers/comments.ts`
3. Delete any comments-related service files
4. Remove comments-related types from shared types

### Phase 3: Frontend Removal (1.5h)

1. Remove comments components directory
2. Remove comments-related hooks
3. Remove comments from any page components
4. Remove comments-related imports

### Phase 4: Database Soft-Deprecation (30 min)

1. Add migration to set `deletedAt` on comments table
2. Keep table for historical reference
3. Add comment to schema marking as deprecated

## Files to Remove/Modify

### Remove Entirely

```
server/routers/comments.ts
client/src/components/comments/ (if exists)
```

### Modify

```
server/routers.ts - Remove commentsRouter import and registration
drizzle/schema.ts - Mark comments table as deprecated (don't delete)
```

## Database Considerations

**DO NOT hard delete the comments table or data.**

Instead:

1. Keep the table definition in schema (marked deprecated)
2. Add a migration that sets `deletedAt = NOW()` on all rows
3. This preserves data for potential future reference

```sql
-- Migration: soft-deprecate-comments.sql
UPDATE comments SET deleted_at = NOW() WHERE deleted_at IS NULL;
```

## Verification Checklist

- [ ] `grep -r "comments" server/` returns no active references
- [ ] `grep -r "comments" client/src/` returns no active references
- [ ] `pnpm typecheck` passes
- [ ] `pnpm build` succeeds
- [ ] `pnpm test` passes
- [ ] Application runs without errors
- [ ] No console errors related to comments

## Rollback Plan

If issues are discovered:

1. Revert the commit
2. Comments table data is preserved (soft delete)
3. Re-add router and components from git history

## Estimate

- **Phase 1**: Audit - 30 min
- **Phase 2**: Backend removal - 1.5h
- **Phase 3**: Frontend removal - 1.5h
- **Phase 4**: Database soft-deprecation - 30 min
- **Total**: 4 hours

## Notes

- This is a cleanup task with LOW priority
- Data preservation is important - use soft delete
- If any critical dependency is found during audit, STOP and report
