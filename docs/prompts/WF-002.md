# WF-002: Unify Dual Batch Status Systems

## Implementation Guide

### Problem

Batches have TWO unrelated status fields:

1. `batchStatus` (enum): AWAITING_INTAKE, LIVE, PHOTOGRAPHY_COMPLETE, ON_HOLD, QUARANTINED, SOLD_OUT, CLOSED
   - Used by 40+ files for business logic
   - Source of truth for actual batch state
2. `statusId` (FK â†’ workflow_statuses): User-defined Kanban columns
   - Only used by workflow-queue feature
   - Purely visual, no business logic
   - Can contradict batchStatus

**Example Contradiction:**

- Batch can be `batchStatus = "LIVE"` but `statusId = "Needs Review"`
- No sync mechanism between them

### Solution

**Option A (Recommended): Deprecate statusId, Enhance batchStatus**

1. Add workflow metadata to batchStatusEnum stages
2. Create `batch_status_config` table with display settings per status
3. Use batchStatus for Kanban board instead of statusId
4. Migrate existing statusId data to notes/metadata
5. Remove statusId column after migration

**Option B: Sync statusId to batchStatus**

1. Create mapping: each workflowStatus maps to a batchStatus
2. Auto-sync: when statusId changes, update batchStatus
3. Validate: prevent invalid combinations

### Files to Modify

**Database:**

- `drizzle/schema.ts` - Add batch_status_config, modify batches
- Migration script for data migration

**Backend:**

- `server/db/queries/workflow-queue.ts` - Use batchStatus instead of statusId
- `server/routers/workflow-queue.ts` - Update queries
- `server/inventoryDb.ts` - May need updates

**Frontend:**

- `client/src/pages/WorkflowQueuePage.tsx` - Use batchStatus for board
- `client/src/components/workflow/*` - Update components

### Acceptance Criteria

- Single source of truth for batch status
- Kanban board reflects actual business status
- No contradictory states possible
- Backward compatible with existing data

### Estimate

2 days
