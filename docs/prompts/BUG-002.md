# BUG-002: Fix Duplicate Navigation Bar on Dashboard

<!-- METADATA (for validation) -->
<!-- TASK_ID: BUG-002 -->
<!-- TASK_TITLE: Fix Duplicate Navigation Bar on Dashboard -->
<!-- PROMPT_VERSION: 1.0 -->
<!-- LAST_VALIDATED: 2025-11-21 -->

**Repository:** https://github.com/EvanTenenbaum/TERP  
**Task ID:** BUG-002  
**Priority:** P0 (CRITICAL - UI BLOCKER)  
**Estimated Time:** 1-2 hours  
**Module:** `client/src/components/`

---

## üìã Table of Contents

1. [Context](#context)
2. [Phase 1: Pre-Flight Check](#phase-1-pre-flight-check)
3. [Phase 2: Session Startup](#phase-2-session-startup)
4. [Phase 3: Development](#phase-3-development)
5. [Phase 4: Completion](#phase-4-completion)
6. [Quick Reference](#quick-reference)
7. [Troubleshooting](#troubleshooting)

---

## üéØ Context

**Background:**
A duplicate navigation bar is appearing in the middle of the dashboard page, showing duplicate menu items (Dashboard, Todo Lists, Calendar, Orders, etc.). This is causing a confusing user experience and may be interfering with sidebar navigation functionality. It could also be related to the login/logout sidebar link (FEATURE-001) not being visible.

**Goal:**
Identify and remove the duplicate navigation bar from the dashboard, ensuring only the correct sidebar navigation is displayed.

**Success Criteria:**

- [ ] Duplicate navigation bar removed from dashboard
- [ ] Only correct sidebar navigation visible
- [ ] No visual regressions on other pages
- [ ] Login/logout link visible in sidebar (if related)
- [ ] All tests passing
- [ ] Manual testing confirms fix

---

## Phase 1: Pre-Flight Check

**Objective:** Verify environment and check for conflicts BEFORE starting work.

### Step 1.1: Register Your Session

1. Create session file: `docs/sessions/active/Session-$(date +%Y%m%d)-BUG-002-$(openssl rand -hex 4).md`
2. Use template: `docs/templates/SESSION_TEMPLATE.md`
3. Fill in your session details.

### Step 1.2: Register Session (Atomic) ‚ö†Ô∏è CRITICAL

**This step prevents race conditions. Follow it exactly.**

1. `git pull origin main` (to get the latest `ACTIVE_SESSIONS.md`)
2. Read `docs/ACTIVE_SESSIONS.md` and check for module conflicts.
3. If clear, add your session to the file:
   ```bash
   echo "- BUG-002: Session-$(date +%Y%m%d)-BUG-002-$(openssl rand -hex 4) ($(date +%Y-%m-%d))" >> docs/ACTIVE_SESSIONS.md
   ```
4. Commit and push **immediately**:
   ```bash
   git add docs/ACTIVE_SESSIONS.md
   git commit -m "Register session for BUG-002"
   git push origin main
   ```
5. **If the push fails due to a conflict, another agent registered first.** STOP, pull again, and re-evaluate. Do not proceed until your session is successfully pushed to `main`.

### Step 1.3: Verify Environment

Run these commands:

```bash
node --version
pnpm --version
git status
```

### Step 1.4: Verify Permissions

Test your push access before starting work:
`git push --dry-run origin main`
If this command fails, you do not have the required permissions. STOP and ask the user for write access to the repository.

---

## Phase 2: Session Startup

**Objective:** Set up your workspace and update the roadmap.

### Step 2.1: Create Feature Branch

```bash
git checkout main
git pull origin main
git checkout -b bug-002-duplicate-nav
```

### Step 2.2: Update Roadmap Status

**File:** `docs/roadmaps/MASTER_ROADMAP.md`

Find the BUG-002 task and update status from `üîç INVESTIGATING` to `‚è≥ IN PROGRESS`.

### Step 2.3: Update Session File Progress

Update your session file with your progress.

---

## Phase 3: Development

**Objective:** Investigate and fix the duplicate navigation bar issue.

### Step 3.1: Investigate the Issue

1. **Examine Dashboard Components:**
   ```bash
   # Check these files for duplicate navigation
   cat client/src/components/Dashboard.tsx
   cat client/src/components/DashboardLayout.tsx
   ```

2. **Search for Navigation Components:**
   ```bash
   # Find all navigation-related components
   grep -r "Navigation\|Sidebar\|Nav" client/src/components/ | grep -i "dashboard"
   ```

3. **Check for Duplicate Imports:**
   - Look for multiple imports of navigation components
   - Check if navigation is rendered in both Dashboard.tsx and DashboardLayout.tsx

### Step 3.2: Identify Root Cause

**Common Causes:**
- Navigation component imported and rendered in Dashboard.tsx when it should only be in DashboardLayout.tsx
- Leftover navigation code from refactoring
- Duplicate component rendering in layout hierarchy

**Investigation Steps:**
1. Check if Dashboard.tsx has its own navigation rendering
2. Verify DashboardLayout.tsx is the only place navigation should be
3. Look for any conditional rendering that might show navigation twice
4. Check mobile vs desktop rendering differences

### Step 3.3: Fix the Issue

**Expected Fix:**
- Remove duplicate navigation rendering from Dashboard.tsx (if present)
- Ensure navigation only appears in DashboardLayout.tsx
- Verify sidebar navigation is properly configured
- Check if login/logout link needs to be added to sidebar

**Files to Modify:**
- `client/src/components/Dashboard.tsx` (likely)
- `client/src/components/DashboardLayout.tsx` (verify)

### Step 3.4: Test the Fix

1. **Run TypeScript Check:**
   ```bash
   pnpm check
   ```

2. **Run Tests:**
   ```bash
   pnpm test
   ```

3. **Manual Testing:**
   - Navigate to dashboard
   - Verify only one navigation bar visible
   - Check sidebar navigation works correctly
   - Verify login/logout link visible (if related)
   - Test on mobile viewport
   - Test on desktop viewport

### Step 3.5: Commit Changes

```bash
git add client/src/components/
git commit -m "Fix BUG-002: Remove duplicate navigation bar from dashboard"
```

---

## Phase 4: Completion

**Objective:** Finalize your work and submit it for review.

### Step 4.1: Verify All Deliverables

- [ ] Duplicate navigation bar removed
- [ ] Only correct sidebar navigation visible
- [ ] No visual regressions
- [ ] All tests passing
- [ ] Manual testing complete

### Step 4.2: Create Completion Report

Use the template at `docs/templates/COMPLETION_REPORT_TEMPLATE.md`.

**Include:**
- Root cause identified
- Files modified
- Testing results
- Before/after screenshots (if possible)

### Step 4.3: Update Roadmap to Complete

**File:** `docs/roadmaps/MASTER_ROADMAP.md`

Update BUG-002 task:
- Change `- [ ]` to `- [x]`
- Change status to `‚úÖ COMPLETE`
- Add completion date: `(Completed: YYYY-MM-DD)`
- Add key commits
- Add actual time spent

### Step 4.4: Archive Session

1. Move session file to `docs/sessions/completed/`
2. Remove from `docs/ACTIVE_SESSIONS.md`

### Step 4.5: Push to Main

```bash
git add docs/roadmaps/MASTER_ROADMAP.md docs/sessions/
git commit -m "Complete BUG-002: Fix duplicate navigation bar"
git push origin bug-002-duplicate-nav:main
```

**DO NOT create a pull request** - push directly to main.

### Step 4.6: Notify User

Inform the user that BUG-002 is complete and has been pushed to main.

---

## ‚ö° Quick Reference

**Key Files:**
- `client/src/components/Dashboard.tsx`
- `client/src/components/DashboardLayout.tsx`

**Related Tasks:**
- FEATURE-001: Login/Logout Sidebar Link (may be related)

**Commands:**
```bash
# Check navigation components
grep -r "Navigation\|Sidebar" client/src/components/

# Run tests
pnpm test

# Type check
pnpm check
```

---

## üÜò Troubleshooting

**Issue: Navigation still appears twice after fix**
- Check if there are multiple Dashboard components
- Verify DashboardLayout is not rendering navigation twice
- Check for CSS that might be duplicating visual appearance

**Issue: Sidebar navigation broken after fix**
- Verify DashboardLayout.tsx still has correct navigation
- Check if any navigation props were accidentally removed
- Test on both mobile and desktop

**Issue: Login/logout link still not visible**
- This may be a separate issue (FEATURE-001)
- Document in completion report if related
- Consider creating follow-up task if needed

---

**Last Updated:** November 21, 2025

