# REL-008: Ledger Immutability + Reversal + Fiscal Period Lock Enforcement

<!-- METADATA (for validation) -->
<!-- TASK_ID: REL-008 -->
<!-- TASK_TITLE: Ledger Immutability + Reversal + Fiscal Period Lock -->
<!-- PROMPT_VERSION: 1.0 -->
<!-- LAST_VALIDATED: 2026-01-08 -->

**Repository:** https://github.com/EvanTenenbaum/TERP  
**Task ID:** REL-008  
**Estimated Time:** 2d  
**Module:** `server/accountingDb.ts`, `server/_core/fiscalPeriod.ts`, `drizzle/`

## Implementation Guide

### Problem
Ledger correctness depends on immutability, balanced postings, and fiscal period lock enforcement.

### Solution
- Enforce: posted journals/entries cannot be edited in place.
- Add reversal entries for corrections.
- Enforce debits == credits validation on write.
- Ensure period locks block postings into locked periods in ALL posting paths.

### Files
- `server/accountingDb.ts`
- `server/services/orderAccountingService.ts`
- `server/_core/fiscalPeriod.ts`
- `drizzle/` schema and migrations

### Tests
- Unbalanced journal attempt -> rejected.
- Posting into locked period -> rejected.
- Reversal restores balances correctly.

### Acceptance Criteria
- Ledger is immutable and auditable.
- Period locks are hard gates with tests.
