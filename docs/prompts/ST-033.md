# ST-033: Mega QA - Backend Invariants Suite (DB Truth / Data Integrity)

## Context

E2E UI success is insufficient if backend state is inconsistent. Mega QA must validate business invariants from trusted sources.

## Implementation Guide

- Implement an invariant runner (script or vitest integration) that can query the test DB and/or call server-side “assert” endpoints (test-only).
- Define invariant categories:
  - inventory: no negative stock, movements reconcile, reserved quantities consistent
  - accounting: double-entry balances, invoice/payment statuses consistent, cash reductions correct for AP
  - referential integrity: no orphaned critical records
- Integrate invariants in Mega QA:
  - preflight invariants after seeding
  - post-journey invariants after workflows
- Emit invariant outputs to the report bundle:
  - invariant id, pass/fail, evidence snapshot (query + counts/rows), repro commands

## Acceptance Notes (for AI-only review)

- Failures must identify which invariant broke and include minimal evidence for debugging.
