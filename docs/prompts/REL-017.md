# REL-017: CI/PR Gates for Critical Domains (Block Merge on Invariant Failures)

<!-- METADATA (for validation) -->
<!-- TASK_ID: REL-017 -->
<!-- TASK_TITLE: CI/PR Gates for Critical Domains -->
<!-- PROMPT_VERSION: 1.0 -->
<!-- LAST_VALIDATED: 2026-01-08 -->

**Repository:** https://github.com/EvanTenenbaum/TERP  
**Task ID:** REL-017  
**Estimated Time:** 16h  
**Module:** CI config, `scripts/`, `server/`

## Implementation Guide

### Problem
Without automated merge gates, regressions in inventory/money logic can ship.

### Solution
- Detect PR touches:
  - `server/inventory*`, `server/accounting*`, `server/services/orderAccountingService.ts`, `drizzle/schema*`, migrations
- If touched, CI must run:
  - critical correctness suite (REL-014)
  - reconciliation report mode (REL-009)
- Fail CI on invariant violations.

### Deliverables
- CI rule detects changes under critical paths (inventory/accounting/ledger/schema)
- Runs critical correctness suite and reconciliation report
- Fails build on invariant violations
- PR checklist updated to reflect reliability gates
- Docs: `docs/reliability/CI_GATES.md`

### Acceptance Criteria
- CI blocks merge when invariants fail for critical domains.
- Docs added: `docs/reliability/CI_GATES.md`.
