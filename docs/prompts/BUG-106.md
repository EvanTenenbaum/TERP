# BUG-106: Fix AR/AP Page 404 Error

<!-- METADATA (for validation) -->
<!-- TASK_ID: BUG-106 -->
<!-- TASK_TITLE: Fix AR/AP Page 404 Error -->
<!-- PROMPT_VERSION: 1.0 -->
<!-- LAST_VALIDATED: 2026-01-25 -->

**Repository:** https://github.com/EvanTenenbaum/TERP  
**Task ID:** BUG-106  
**Estimated Time:** 4h  
**Module:** `client/src/pages/accounting/ARAP.tsx`, `client/src/router.tsx`

‚ö†Ô∏è **SECURITY WARNING**

- NEVER include real secrets in this prompt
- Use placeholders like: `YOUR_API_KEY_HERE`
- Secrets belong in `.env` file only

---

## üìã Table of Contents

1. [Context](#context)
2. [Phase 1: Pre-Flight Check](#phase-1-pre-flight-check)
3. [Phase 2: Session Startup](#phase-2-session-startup)
4. [Phase 3: Development](#phase-3-development)
5. [Phase 4: Completion](#phase-4-completion)
6. [Quick Reference](#quick-reference)
7. [Troubleshooting](#troubleshooting)

---

## üéØ Context

**Background:**
During Frontend QA testing on Jan 25, 2026, it was discovered that the AR/AP link in the Finance navigation menu leads to a 404 page at `/accounting/arap`. The navigation link exists but the page/route is not implemented.

**Goal:**
Either implement the AR/AP (Accounts Receivable/Accounts Payable) page or fix the route configuration to point to existing AR/AP functionality.

**Success Criteria:**

- AR/AP page loads without 404 error
- AR/AP page displays accounts receivable and payable information
- Navigation link works correctly
- Page is accessible to users with appropriate permissions

---

## Implementation Guide

### Step 1: Investigate Current State

1. Check if AR/AP page component exists
2. Check route configuration for `/accounting/arap`
3. Review existing AR/AP API endpoints (accounting.getARSummary, getARAging, etc.)
4. Determine if this is a missing route or missing page

### Step 2: Review Existing AR/AP Functionality

The following tRPC endpoints may already exist:
- `accounting.getARSummary`
- `accounting.getARAging`
- `accounting.getAPSummary`
- `accounting.getTotalCashBalance`

### Step 3: Implementation

Create or fix the AR/AP page:

```typescript
// client/src/pages/accounting/ARAP.tsx
export function ARAPPage() {
  const { data: arSummary } = trpc.accounting.getARSummary.useQuery();
  const { data: arAging } = trpc.accounting.getARAging.useQuery();
  const { data: apSummary } = trpc.accounting.getAPSummary.useQuery();

  return (
    <PageLayout title="Accounts Receivable / Payable">
      <div className="grid grid-cols-2 gap-4">
        <ARSummaryCard data={arSummary} />
        <APSummaryCard data={apSummary} />
      </div>
      <ARAgingTable data={arAging} />
    </PageLayout>
  );
}
```

Add route configuration:

```typescript
// In router configuration
{
  path: '/accounting/arap',
  element: <ARAPPage />,
}
```

### Step 4: Add Permission Check

Ensure appropriate RBAC permissions:
- Finance users should have full access
- Implement permission middleware if needed

### Step 5: Test

1. Navigate via Finance menu
2. Navigate via direct URL
3. Test with different user roles
4. Verify data displays correctly

---

## Phase 1: Pre-Flight Check

**Objective:** Verify environment and check for conflicts BEFORE starting work.

### Step 1.1: Register Your Session

1. Create session file: `docs/sessions/active/Session-[DATE]-[NUMBER].md`
2. Use template: `docs/templates/SESSION_TEMPLATE.md`
3. Fill in your session details.

### Step 1.2: Register Session (Atomic) ‚ö†Ô∏è CRITICAL

**This step prevents race conditions. Follow it exactly.**

1.  `git pull origin main` (to get the latest `ACTIVE_SESSIONS.md`)
2.  Read `docs/ACTIVE_SESSIONS.md` and check for module conflicts.
3.  If clear, add your session to the file.
4.  Commit and push **immediately**:
    ```bash
    git add docs/ACTIVE_SESSIONS.md
    git commit -m "Register session for BUG-106"
    git push origin main
    ```

---

## Phase 2: Session Startup

**Objective:** Set up your workspace and update the roadmap.

### Step 2.1: Create Feature Branch

```bash
git checkout main
git pull origin main
git checkout -b fix/BUG-106-arap-page-404
```

### Step 2.2: Update Roadmap Status

**File:** `docs/roadmaps/MASTER_ROADMAP.md`

Change the status of BUG-106 to `in-progress`.

---

## Phase 3: Development

**Objective:** Fix the AR/AP page 404 error.

1. Investigate current state of AR/AP page/route
2. Review existing accounting API endpoints
3. Implement fix (add route, create page, or fix navigation)
4. Connect to existing tRPC endpoints
5. Add permission checks
6. Test all access scenarios

---

## Phase 4: Completion

**Objective:** Finalize your work and submit it for review.

### Step 4.1: Verify All Deliverables

- [ ] AR/AP page accessible via navigation
- [ ] AR/AP page accessible via direct URL
- [ ] No 404 error
- [ ] AR/AP data displays correctly
- [ ] Appropriate permissions enforced
- [ ] All tests pass

### Step 4.2: Create Completion Report

Use the template at `docs/templates/COMPLETION_REPORT_TEMPLATE.md`.

### Step 4.3: Update Roadmap to `complete`

Change the status of BUG-106 to `complete` in `docs/roadmaps/MASTER_ROADMAP.md`.

---

## ‚ö° Quick Reference

**Files to investigate/modify:**
- `client/src/router.tsx`
- `client/src/pages/accounting/ARAP.tsx` (may need to create)
- `server/routers/accounting.ts` (existing endpoints)

**Related tRPC endpoints:**
- `accounting.getARSummary`
- `accounting.getARAging`
- `accounting.getAPSummary`
- `accounting.getTotalCashBalance`

**Related bugs:**
- BUG-105: Reports page 404 (same pattern)
- BUG-092: AR/AP dashboard widgets (previously fixed)

---

## üÜò Troubleshooting

**Issue:** Route exists but page doesn't load
**Solution:** Check lazy loading configuration and component exports

**Issue:** API endpoints return errors
**Solution:** Verify accounting router is properly registered

**Issue:** Permission denied after fix
**Solution:** Verify RBAC permissions for accounting access
