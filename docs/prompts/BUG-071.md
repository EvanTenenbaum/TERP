# BUG-071: Add Rollback to PurchaseModal Media Upload

## Implementation Guide

### Problem
In `PurchaseModal.tsx` (lines 164-200), media files are uploaded before record creation. If the purchase creation fails, orphaned media files remain in storage.

### Current Flow
1. User fills form
2. Media files uploaded (committed to storage)
3. Purchase record creation attempted
4. If step 3 fails, media files from step 2 are orphaned

### Solution
Option A: Upload after record creation
1. Create purchase record first
2. Upload media with record ID
3. Update record with media links

Option B: Implement cleanup on failure
1. Track uploaded media IDs
2. On purchase creation failure, delete uploaded media
3. Add try/catch with cleanup logic

### Files to Modify
- `client/src/components/inventory/PurchaseModal.tsx`

### Implementation (Option B)
```typescript
let uploadedMediaIds: number[] = [];
try {
  // Upload media
  uploadedMediaIds = await Promise.all(mediaFiles.map(uploadMedia));

  // Create purchase
  await createPurchase({ ...data, mediaIds: uploadedMediaIds });
} catch (error) {
  // Cleanup orphaned media
  await Promise.all(uploadedMediaIds.map(deleteMedia));
  throw error;
}
```

### Acceptance Criteria
- No orphaned media files on failed submissions
- Clear error message to user
- Data integrity maintained
