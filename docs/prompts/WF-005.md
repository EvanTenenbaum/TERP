# WF-005: Add SLA Tracking and Escalation

## Implementation Guide

### Problem

No time-based tracking for workflow items:

- No deadline when item enters a status
- No escalation if not processed in time
- No visibility into aging items

### Solution

**Step 1: Add SLA tracking columns**

```sql
ALTER TABLE workflow_statuses ADD COLUMN slaMinutes INT;
ALTER TABLE workflow_statuses ADD COLUMN escalationRoleId INT REFERENCES roles(id);
ALTER TABLE batch_status_history ADD COLUMN slaDeadline TIMESTAMP;
ALTER TABLE batch_status_history ADD COLUMN isEscalated BOOLEAN DEFAULT false;
```

**Step 2: Calculate SLA deadline on status change**
When batch enters a status with slaMinutes > 0:

- Set `slaDeadline = NOW() + slaMinutes`
- Create scheduled escalation check

**Step 3: Escalation cron job**

```typescript
// server/cron/slaEscalationCron.ts
// Every 15 minutes, check for overdue items
const overdueItems = await db.query(`
  SELECT * FROM batch_status_history 
  WHERE slaDeadline < NOW() 
  AND isEscalated = false
`);

for (const item of overdueItems) {
  await sendEscalationNotification(item);
  await markAsEscalated(item.id);
}
```

**Step 4: Visual indicators**

- Show time remaining in Kanban cards
- Highlight overdue items in red
- Show escalation badge if escalated

### Files to Modify

- `drizzle/schema.ts` - Add SLA columns
- `server/db/queries/workflow-queue.ts` - Handle SLA deadlines
- `server/cron/slaEscalationCron.ts` (NEW)
- `client/src/pages/WorkflowQueuePage.tsx` - SLA indicators
- `client/src/components/workflow/WorkflowCard.tsx` - Time remaining

### Acceptance Criteria

- SLA deadline set when entering configured status
- Visual countdown in UI
- Escalation notification when SLA exceeded
- Dashboard shows SLA health metrics

### Estimate

16 hours
