# BUG-021: Command Palette (Cmd+K) Not Working

**Repository:** https://github.com/EvanTenenbaum/TERP
**Task ID:** BUG-021
**Priority:** MEDIUM
**Estimated Time:** 4-8 hours
**Module:** `client/src/components/CommandPalette.tsx`

---

## Context

The Cmd+K (Mac) / Ctrl+K (Windows/Linux) keyboard shortcut does not open the command palette modal. The feature may be partially implemented or the keyboard listener is not properly attached.

## Implementation Guide

### Step 1: Investigate Current State

Find the CommandPalette component:

```bash
find client/src -name "*[Cc]ommand*" -o -name "*[Pp]alette*"
grep -r "cmdk\|command-palette\|CommandPalette" client/src
```

Check if keyboard listener exists:

```bash
grep -r "keydown\|Meta.*[kK]\|Ctrl.*[kK]" client/src/components
```

### Step 2: Debug Keyboard Listener

Check for:

- Event listener registration (useEffect with keydown)
- Correct key combination detection (metaKey or ctrlKey + 'k')
- Listener attached at app level vs component level
- State management for open/closed modal

### Step 3: Fix or Implement Keyboard Listener

Ensure keyboard listener in `CommandPalette.tsx` or app root:

```tsx
useEffect(() => {
  const handleKeyDown = (e: KeyboardEvent) => {
    if ((e.metaKey || e.ctrlKey) && e.key === "k") {
      e.preventDefault();
      setOpen(true);
    }
  };

  document.addEventListener("keydown", handleKeyDown);
  return () => document.removeEventListener("keydown", handleKeyDown);
}, []);
```

### Step 4: Verify Modal Opens

- Ensure CommandPalette component is rendered in app
- Verify modal state is properly controlled
- Test open/close functionality

### Step 5: Add Visual Indicator (Optional)

Add keyboard shortcut hint in header search bar:

```tsx
<span className="text-xs text-muted-foreground">âŒ˜K</span>
```

### Step 6: Test

- Test Cmd+K on Mac
- Test Ctrl+K on Windows/Linux
- Test from various pages
- Verify modal opens and closes correctly

## Success Criteria

- [ ] Cmd+K (Mac) opens command palette
- [ ] Ctrl+K (Windows/Linux) opens command palette
- [ ] Modal opens/closes correctly
- [ ] Works from any page
- [ ] All tests passing
- [ ] Zero TypeScript errors

---

**Last Updated:** November 30, 2025
