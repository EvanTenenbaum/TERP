# SEC-030: Fix RBAC Router Deceptive publicProcedure Alias

## Problem

The RBAC roles router at `server/routers/rbac-roles.ts` imports `publicProcedure as protectedProcedure`, making all RBAC procedures appear protected in code while actually being completely public. This is a catastrophic security flaw that compromises the entire permission system.

## Implementation Guide

### Step 1: Fix the Import

```typescript
// BEFORE (DANGEROUS):
import { publicProcedure as protectedProcedure, router } from "../_core/trpc";

// AFTER (CORRECT):
import { protectedProcedure, router } from "../_core/trpc";
```

### Step 2: Add Permission Middleware

Ensure all RBAC operations require appropriate permissions:

```typescript
.use(requirePermission("rbac:roles:read"))   // for queries
.use(requirePermission("rbac:roles:write"))  // for mutations
```

### Step 3: Verify Authentication

Test that unauthenticated requests are rejected:

```bash
curl -X POST http://localhost:3000/trpc/rbac.roles.list \
  -H "Content-Type: application/json"
# Should return 401 Unauthorized
```

## Acceptance Criteria

- [ ] Import uses actual protectedProcedure from trpc
- [ ] All rbac-roles endpoints require authentication
- [ ] Unauthenticated requests return 401
- [ ] RBAC functionality works for authenticated admin users
- [ ] Integration test added for security verification

## Files to Modify

- `server/routers/rbac-roles.ts`

## Testing

```bash
pnpm test server/routers/rbac-roles.test.ts
```
