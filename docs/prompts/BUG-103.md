# BUG-103: Remove QA Role Switcher Password Exposure from Production Login

<!-- METADATA (for validation) -->
<!-- TASK_ID: BUG-103 -->
<!-- TASK_TITLE: Remove QA Role Switcher Password Exposure from Production Login -->
<!-- PROMPT_VERSION: 1.0 -->
<!-- LAST_VALIDATED: 2026-01-25 -->

**Repository:** https://github.com/EvanTenenbaum/TERP  
**Task ID:** BUG-103  
**Estimated Time:** 2h  
**Module:** `client/src/pages/Login.tsx`

‚ö†Ô∏è **SECURITY WARNING**

- NEVER include real secrets in this prompt
- Use placeholders like: `YOUR_API_KEY_HERE`
- Secrets belong in `.env` file only

---

## üìã Table of Contents

1. [Context](#context)
2. [Phase 1: Pre-Flight Check](#phase-1-pre-flight-check)
3. [Phase 2: Session Startup](#phase-2-session-startup)
4. [Phase 3: Development](#phase-3-development)
5. [Phase 4: Completion](#phase-4-completion)
6. [Quick Reference](#quick-reference)
7. [Troubleshooting](#troubleshooting)

---

## üéØ Context

**Background:**
During Frontend QA testing on Jan 25, 2026, a critical security issue was discovered on the production login page. The "QA Role Switcher" panel displays a visible password hint "TerpQA2026!" to anyone viewing the login page. This exposes test credentials publicly.

**Goal:**
Remove or conditionally hide the QA Role Switcher and password hint from the production login page while keeping it available in development/testing environments.

**Success Criteria:**

- QA Role Switcher is not visible on production login page
- Password hints are never displayed in production
- QA Role Switcher remains functional in development environment
- No regression in login functionality

---

## Implementation Guide

### Step 1: Locate the QA Role Switcher Component

Find the QA Role Switcher in the login page component:
- File: `client/src/pages/Login.tsx` or similar
- Look for "QA Role Switcher" text and the password display

### Step 2: Add Environment Check

Wrap the QA Role Switcher in an environment check:

```typescript
// Only show QA Role Switcher in non-production environments
const showQASwitcher = import.meta.env.DEV || import.meta.env.VITE_QA_AUTH_ENABLED === 'true';

{showQASwitcher && (
  <QARoleSwitcher />
)}
```

### Step 3: Remove Password Display

Even in development, consider removing the visible password hint:
- Replace `Password: TerpQA2026!` with a reference to documentation
- Or remove the password display entirely

### Step 4: Verify Environment Variables

Ensure `QA_AUTH_ENABLED` is properly set:
- Production: `QA_AUTH_ENABLED=false` or unset
- Development/Testing: `QA_AUTH_ENABLED=true`

### Step 5: Test Both Environments

1. Test in development mode - QA Switcher should appear
2. Test in production build - QA Switcher should be hidden
3. Verify login still works in both modes

---

## Phase 1: Pre-Flight Check

**Objective:** Verify environment and check for conflicts BEFORE starting work.

### Step 1.1: Register Your Session

1. Create session file: `docs/sessions/active/Session-[DATE]-[NUMBER].md`
2. Use template: `docs/templates/SESSION_TEMPLATE.md`
3. Fill in your session details.

### Step 1.2: Register Session (Atomic) ‚ö†Ô∏è CRITICAL

**This step prevents race conditions. Follow it exactly.**

1.  `git pull origin main` (to get the latest `ACTIVE_SESSIONS.md`)
2.  Read `docs/ACTIVE_SESSIONS.md` and check for module conflicts.
3.  If clear, add your session to the file.
4.  Commit and push **immediately**:
    ```bash
    git add docs/ACTIVE_SESSIONS.md
    git commit -m "Register session for BUG-103"
    git push origin main
    ```
5.  **If the push fails due to a conflict, another agent registered first.** STOP, pull again, and re-evaluate.

---

## Phase 2: Session Startup

**Objective:** Set up your workspace and update the roadmap.

### Step 2.1: Create Feature Branch

```bash
git checkout main
git pull origin main
git checkout -b fix/BUG-103-qa-switcher-security
```

### Step 2.2: Update Roadmap Status

**File:** `docs/roadmaps/MASTER_ROADMAP.md`

Change the status of BUG-103 to `in-progress`.

---

## Phase 3: Development

**Objective:** Fix the security issue.

1. Locate QA Role Switcher component in login page
2. Add environment-based conditional rendering
3. Remove or hide password display
4. Test in both dev and production builds
5. Verify no regression in login functionality

---

## Phase 4: Completion

**Objective:** Finalize your work and submit it for review.

### Step 4.1: Verify All Deliverables

- [ ] QA Role Switcher hidden in production
- [ ] Password hint removed from display
- [ ] Login functionality works in both environments
- [ ] Tests pass

### Step 4.2: Create Completion Report

Use the template at `docs/templates/COMPLETION_REPORT_TEMPLATE.md`.

### Step 4.3: Update Roadmap to `complete`

Change the status of BUG-103 to `complete` in `docs/roadmaps/MASTER_ROADMAP.md`.

### Step 4.4: Push to Main

Push your changes directly to the `main` branch.

---

## ‚ö° Quick Reference

**Files to modify:**
- `client/src/pages/Login.tsx` (or equivalent login component)

**Environment variables:**
- `QA_AUTH_ENABLED` - controls QA auth feature visibility

---

## üÜò Troubleshooting

**Issue:** QA Switcher still visible in production
**Solution:** Verify environment variables are correctly set in production deployment

**Issue:** Login broken after changes
**Solution:** Ensure conditional rendering only affects QA Switcher, not core login form
