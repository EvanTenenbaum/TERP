#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Source shared config
. "$(dirname -- "$0")/qa-config.sh"

echo "üîç Running pre-push checks..."

CURRENT_BRANCH=$(git rev-parse --abbrev-ref HEAD)

# Check 1: Prevent direct push to main
if [ "$CURRENT_BRANCH" == "main" ]; then
  echo "‚ùå PUSH BLOCKED: Direct push to main is not allowed. Please use a PR."
  exit 1
fi

# Check 2: Verify branch name format
if [[ ! "$CURRENT_BRANCH" =~ $BRANCH_NAME_REGEX ]]; then
  echo "‚ùå PUSH BLOCKED: Invalid branch name format: $CURRENT_BRANCH"
  echo "   To fix: Use 'pnpm start-task' to create a proper branch."
  exit 1
fi

echo "‚úÖ All pre-push checks passed"
exit 0
