# Oracle: Accounting.COGS.UpdateBatchCogs
# Update COGS for a batch with audit trail and optional order propagation

flow_id: "Accounting.COGS.UpdateBatchCogs"
description: "Validate that batch cost information is visible from inventory batch detail"
role: "InventoryManager"
seed_profile: "inventory_costing"
tags:
  - tier1
  - accounting
  - cogs
  - inventory
  - audit
timeout: 45000

preconditions:
  ensure:
    - entity: "batch"
      ref: "seed:batch.cost_visible"
      where:
        deletedAt_null: true

steps:
  - action: navigate
    path: "/inventory"
    wait_for: "[data-testid='inventory-table'], table, main"

  - action: wait
    network_idle: true
    timeout: 10000

  - action: click
    target: "[data-testid='batch-row-{{seed:batch.cost_visible.id}}'], tr[data-batch-id='{{seed:batch.cost_visible.id}}'], table tbody tr:first-child"
    wait_after: 700

  - action: wait
    for: "[data-testid='batch-detail'], .batch-detail, [role='complementary'], aside[role='complementary']"
    timeout: 10000

  - action: screenshot
    name: "batch_cost_visible"

expected_ui:
  visible:
    - "[data-testid='batch-detail'], main"
  text_present:
    - "Cost"

expected_db:
  batches:
    - where:
        id: "$seed:batch.cost_visible.id"
      expect:
        deleted_at_null: true
        unitCogs_not_null: true
      store_as: "cost_batch"
