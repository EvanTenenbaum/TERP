# Oracle: Accounting.Invoices.MarkSent
# Quick action to mark invoice as sent

flow_id: "Accounting.Invoices.MarkSent"
description: "Send a payment reminder from the invoice detail quick actions"
role: "AccountingManager"
seed_profile: "basic_sales"
tags:
  - tier1
  - accounting
  - invoices
  - quick-action
  - mutation
timeout: 30000

preconditions:
  ensure:
    - entity: "invoice"
      ref: "seed:invoice.reminder_target"
      where:
        status_in: ["VIEWED", "SENT", "PARTIAL", "OVERDUE"]
        deletedAt_null: true

steps:
  - action: navigate
    path: "/accounting/invoices"
    wait_for: "[data-testid='invoices-table'], table, main"

  - action: wait
    network_idle: true
    timeout: 10000

  - action: click
    target: "tr:has-text('VIEWED'), tr:has-text('SENT'), tr:has-text('PARTIAL'), tr:has-text('OVERDUE'), [data-testid='invoice-row-{{seed:invoice.reminder_target.id}}'], tr[data-invoice-id='{{seed:invoice.reminder_target.id}}']"
    wait_after: 500

  - action: wait
    for: "[data-testid='invoice-detail'], .invoice-detail, [role='complementary'], aside[role='complementary']"
    timeout: 10000

  - action: click
    target: "[data-testid='mark-sent-btn'], button:contains('Send Payment Reminder'), button:contains('Send')"
    wait_after: 2000

  - action: wait
    for: "[data-testid='sent-success'], [data-sonner-toast], [role='status'], .success-toast, .toast-success"
    timeout: 10000

  - action: screenshot
    name: "invoice_marked_sent"

expected_ui:
  visible:
    - "[data-testid='invoice-detail'], main"
  text_present:
    - "Payment reminder"
